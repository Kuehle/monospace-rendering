import { createRect, compose, toTransparancy } from '../index'
import { reduce } from '../util/array'

const drawStaff = (width: number) => {
    const canvas = createRect({ width, height: 24, char: '.' })
    const line = createRect({ width, height: 1, char: '=' })

    const result = reduce(
        Array(5),
        (result, _, i) => compose(result, line, { y: 4 + i * 4 }),
        canvas
    )

    return result
}

test('draw full note', () => {
    const canvas = drawStaff(60)

    expect(canvas).toEqual([
        '............................................................',
        '............................................................',
        '............................................................',
        '............................................................',
        '============================================================',
        '............................................................',
        '............................................................',
        '............................................................',
        '============================================================',
        '............................................................',
        '............................................................',
        '............................................................',
        '============================================================',
        '............................................................',
        '............................................................',
        '............................................................',
        '============================================================',
        '............................................................',
        '............................................................',
        '............................................................',
        '============================================================',
        '............................................................',
        '............................................................',
        '............................................................',
    ])

    const noteHead = toTransparancy(
        ['   ███████  ', ' ██       ██', '██       ██ ', '  ███████   '],
        ' '
    )

    const result = compose(canvas, noteHead, { x: 8, y: 17 })

    expect(result).toMatchInlineSnapshot(`
        Array [
          "............................................................",
          "............................................................",
          "............................................................",
          "............................................................",
          "============================================================",
          "............................................................",
          "............................................................",
          "............................................................",
          "============================================================",
          "............................................................",
          "............................................................",
          "............................................................",
          "============================================================",
          "............................................................",
          "............................................................",
          "............................................................",
          "============================================================",
          "...........███████..........................................",
          ".........██.......██........................................",
          "........██.......██.........................................",
          "==========███████===========================================",
          "............................................................",
          "............................................................",
          "............................................................",
        ]
    `)
})

test('draw half note', () => {
    const canvas = drawStaff(60)

    expect(canvas).toEqual([
        '............................................................',
        '............................................................',
        '............................................................',
        '............................................................',
        '============================================================',
        '............................................................',
        '............................................................',
        '............................................................',
        '============================================================',
        '............................................................',
        '............................................................',
        '............................................................',
        '============================================================',
        '............................................................',
        '............................................................',
        '............................................................',
        '============================================================',
        '............................................................',
        '............................................................',
        '............................................................',
        '============================================================',
        '............................................................',
        '............................................................',
        '............................................................',
    ])

    const noteHead = toTransparancy(
        ['   ███████  ', ' ██       ██', '██       ██ ', '  ███████   '],
        ' '
    )

    const noteStem = createRect({ width: 2, height: 12, char: '█' })
    const noteBackground = createRect({ width: 12, height: 15, char: ' ' })

    const note = compose(
        compose(noteBackground, noteHead, { y: 11 }),
        noteStem,
        { x: 10 }
    )

    expect(note).toMatchInlineSnapshot(`
        Array [
          "          ██",
          "          ██",
          "          ██",
          "          ██",
          "          ██",
          "          ██",
          "          ██",
          "          ██",
          "          ██",
          "          ██",
          "          ██",
          "   █████████",
          " ██       ██",
          "██       ██ ",
          "  ███████   ",
        ]
    `)
})
